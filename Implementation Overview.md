# معرفی کلی پروژه
این پروژه یک سامانه **تشخیص و احراز هویت چهره** است که با استفاده از دوربین (مانند دوربین‌های مدار بسته، تصویر افراد را دریافت کرده و با مقایسه آن با اطلاعات ذخیره‌شده، هویت فرد را تشخیص می‌دهد.

هدف اصلی سیستم:
- ثبت لاگ ورود و خروج كاركنان 
- شناسایی افراد مجاز
- تشخیص افراد ناشناس
- امکان ثبت و مدیریت چهره‌ها
- مقیاس‌پذیری برای استفاده در محیط‌های واقعی (شرکت، سازمان، فروشگاه، ساختمان)

---

# پیش‌نیازهای طراحی پروژه (موارد تصمیم‌گیری اولیه)

## 1. تعداد افراد (Subjects)
قبل از پیاده‌سازی، باید مشخص شود:
- چه تعداد فرد قرار است در سیستم ثبت شوند (ده‌ها، صدها، هزاران نفر)
- برای هر فرد چند تصویر ذخیره می‌شود (حداقل 3 تا 5 تصویر)

**شرایط تصاویر:**
- تمام‌رخ (Frontal)
- سه‌رخ (Left / Right Profile)
- نور مناسب و بدون پوشش صورت

> هرچه تنوع زاویه و نور بیشتر باشد، دقت سیستم  بالاتر خواهد بود.

---

## 2. تعداد دوربین‌ها و شرایط نصب
- تعداد دوربین‌های فعال هم‌زمان
- نوع دوربین (CCTV، IP Camera)
- رزولوشن و فریم‌ریت
- فاصله چهره تا دوربین (Optimal Distance)
- زاویه نصب دوربین

> فاصله زیاد یا زاویه نامناسب باعث کاهش دقت تشخیص چهره می‌شود.

---

## 3. زیرساخت سخت‌افزاری
انتخاب سخت‌افزار مستقیماً به موارد بالا وابسته است.

### کارت گرافیک (GPU)
- توصیه‌شده: NVIDIA (برای استفاده از CUDA)
- افزایش سرعت پردازش چند دوربین هم‌زمان

### CPU و Mainboard
- CPU چند هسته‌ای قوی
- مادربرد پایدار برای پردازش 24/7

---

# اجزای اصلی سیستم

## 1. بخش دریافت تصویر (Image Acquisition)
- دوربین مدار بسته (IP Camera) 
- دریافت فریم‌های تصویر به‌صورت زنده (Real-time)
- امکان اتصال چند دوربین به یک سرور مرکزی

**ابزارها و تکنولوژی‌ها:**
- OpenCV
- RTSP / HTTP Stream

---

## 2. تشخیص حرکت و حضور فرد (Pose / Motion Detection)
برای دوربین‌های CCTV ابتدا بررسی می‌شود آیا فردی در صحنه حضور دارد یا خیر.

**اهداف:**
- کاهش پردازش غیرضروری
- فعال‌سازی تشخیص چهره فقط در صورت وجود انسان

**ابزارها:**
- Pose Detection
- Motion Detection

---

## 3. تشخیص چهره (Face Detection)
در این مرحله سیستم بررسی می‌کند آیا در تصویر چهره‌ای وجود دارد یا خیر.

**وظیفه:**
- پیدا کردن محل چهره در تصویر
- برش (Crop) ناحیه چهره

**ابزارها:**
- مدل‌های مبتنی بر CNN
- InsightFace / RetinaFace / MTCNN

---

## 4. استخراج و نرمال‌سازی چهره (Face Extraction & Alignment)
پس از تشخیص چهره:
- چهره صاف‌سازی (Alignment) می‌شود
- ناحیه استاندارد چهره استخراج می‌گردد

---

## 5. استخراج ویژگی (Face Embedding)
پس از استخراج چهره، تصویر به یک **بردار عددی (Embedding)** تبدیل می‌شود.

**نکته مهم برای کارفرما:**
> تصویر خام ذخیره نمی‌شود؛ فقط بردار عددی ذخیره می‌شود.

**ابزارها:**
- InsightFace
- ArcFace
- مدل‌های ONNX

---

## 4. پایگاه داده برداری (Vector Database)
بردارهای چهره در یک دیتابیس مخصوص جستجوی برداری ذخیره می‌شوند.

**چرا دیتابیس معمولی کافی نیست؟**
- جستجو بر اساس «شباهت عددی» انجام می‌شود نه متن یا ID
- سرعت بسیار بالا برای مقایسه هزاران یا میلیون‌ها چهره

**گزینه‌های پیشنهادی:**
- **Qdrant** (سبک، رایگان، مناسب ویندوز و لینوکس)
- FAISS (کتابخانه، نه دیتابیس مستقل)
- Milvus (برای مقیاس خیلی بزرگ)

**انتخاب فعلی پروژه:**
- Qdrant (Self-hosted)

---

## 7. جستجوی شباهت و تصمیم‌گیری (Similarity Search)
در این مرحله بردار چهره جدید با بردارهای ذخیره‌شده مقایسه می‌شود.

**روش‌های محاسبه شباهت:**
- Cosine Similarity (پیشنهادی)
- Inner Product
- L2 Distance

**نکات فنی مهم:**
- تعیین Threshold مناسب
- بالانس بین False Accept و False Reject

---

## 6. بخش منطق کسب‌وکار (Business Logic)
قوانینی که مشخص می‌کند بعد از شناسایی چه اتفاقی بیفتد:
- ثبت ورود و خروج
- ارسال هشدار
- باز شدن درب
- ذخیره لاگ

---

# زیرساخت سخت‌افزاری پیشنهادی

## حداقل نیازها:
- CPU مناسب (Intel i5 به بالا)
- RAM حداقل 16GB
- GPU (در صورت نیاز به پردازش سریع‌تر)

**نکته:**
- سیستم بدون GPU هم کار می‌کند، ولی GPU سرعت را چند برابر می‌کند
- در صورت استفاده از NVIDIA می‌توان از CUDA استفاده کرد

---

# معماری کلی سیستم

1. دوربین تصویر را ارسال می‌کند
2. سرور تصویر را دریافت می‌کند
3. چهره تشخیص داده می‌شود
4. Embedding استخراج می‌شود
5. بردار در دیتابیس جستجو می‌شود
6. نتیجه به سیستم اعلام می‌شود

---

# مزایای این راهکار
- مقیاس‌پذیر
- قابل توسعه
- امنیت بالا (عدم ذخیره تصویر خام)
- سرعت بالا
- امکان اتصال به سیستم‌های دیگر

---

# مراحل اجرایی پروژه

1. آماده‌سازی دیتاست اولیه چهره‌ها
2. پیاده‌سازی Pipeline تشخیص چهره
3. راه‌اندازی Vector Database
4. تست دقت و سرعت
5. اتصال به دوربین واقعی
6. تحویل نسخه MVP

---

# نکات تکمیلی و پیشنهادهای فنی
- امکان ثبت چند Embedding برای هر فرد
- استفاده از Quality Check (وضوح، زاویه، نور)
- لاگ‌گیری و مانیتورینگ سیستم
- امکان توسعه به چند سرور (Scalability)

---

# جمع‌بندی نهایی
این سیستم بر اساس شرایط واقعی محیط (تعداد افراد، دوربین‌ها، فاصله، سخت‌افزار) طراحی می‌شود و انتخاب مدل‌ها و زیرساخت به‌صورت منعطف انجام می‌گیرد تا بهترین دقت و پایداری حاصل شود.

